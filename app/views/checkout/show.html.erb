<div class="checkout-container">
  <!-- Th√™m ph·∫ßn hi·ªÉn th·ªã th√¥ng b√°o -->
  <% if flash[:error] %>
    <div class="alert alert-danger">
      <%= flash[:error] %>
    </div>
  <% end %>

  <% if flash[:success] %>
    <div class="alert alert-success">
      <%= flash[:success] %>
    </div>
  <% end %>

  <div class="checkout-layout">
    <%= form_with(url: create_order_path, local: true, class: 'checkout-form') do |f| %>
      <div class="checkout-left">
        <h2 style="font-size: 20px; font-weight: 900; color: red; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; text-align: center; ">TH√îNG TIN ƒê·∫∂T H√ÄNG</h2>
        <div class="form-section">
          <h3>Th√¥ng tin ng∆∞·ªùi ƒë·∫∑t h√†ng</h3>
          <%= f.hidden_field :customer_name, value: @user.username %>
          <%= f.hidden_field :customer_email, value: @user.email %>
          <%= f.hidden_field :id_sp, value: @product.id %>
          <%= f.hidden_field :tongtien, value: @total %>
          <%= f.hidden_field :quantity, value: @quantity %>
          
          <!-- Hi·ªÉn th·ªã th√¥ng tin readonly -->
          <div class="form-group">
            <label>H·ªç v√† t√™n</label>
            <input type="text" value="<%= @user.username %>" readonly class="form-control">
          </div>
          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i</label>
            <input type="text" id="order_phone" value="<%= current_user.sdt %>" readonly class="form-control">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" value="<%= @user.email %>" readonly class="form-control">
          </div>
          <div class="form-group">
            <label>ƒê·ªãa ch·ªâ</label>
            <input type="text" id="order_address" value="<%= current_user.diachi %>" readonly class="form-control">
          </div>
        </div>
        <div class="checkout-summary-right">
        <!-- Th√¥ng tin ƒë∆°n h√†ng -->
        <div class="form-section order-summary">
          <h2 style="font-size: 18px; font-weight: 500; color: #333; margin-bottom: 15px;">Th√¥ng tin ƒë∆°n h√†ng</h2>
          <table class="order-details">
            <thead>
              <tr>
                <th>H√¨nh ·∫£nh</th>
                <th>T√™n s·∫£n ph·∫©m</th>
                <th>S·ªë l∆∞·ª£ng</th>
                <th>ƒê∆°n gi√°</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="product-image">
                  <%= image_tag "/assets/#{@product.image_path}" if @product.image_path.present? %>
                </td>
                <td><%= @product.name %></td>
                <td><%= @quantity %></td>
                <td><%= number_to_currency(@product.price, unit: 'ƒë', precision: 0, delimiter: '.') %></td>
              </tr>
            </tbody>
          </table>

          <div class="order-total">
            <span class="total-label">T·ªïng ti·ªÅn:</span>
            <span style="color: red;;" class="total-amount"><%= number_to_currency(@total, unit: 'ƒë', precision: 0, delimiter: '.') %></span>
          </div>

          <%= f.hidden_field :id_sp, value: @product.id %>
          <%= f.hidden_field :tongtien, value: @total %>

          
        </div>
      </div>

      <div class="checkout-right">
        <!-- Th√¥ng tin ng∆∞·ªùi nh·∫≠n -->
          <h3 style="font-size: 16px; font-weight: 500; color: #333; margin-bottom: 15px;">Th√¥ng tin ng∆∞·ªùi nh·∫≠n</h3>
        <div class="form-section">
        
          <div class="form-group">
            <input type="checkbox" id="sameAsOrder" onchange="copyOrderInfo(this)">
            <label for="sameAsOrder">Th√¥ng tin ng∆∞·ªùi nh·∫≠n</label>
          </div>
          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i</label>
            <%= f.text_field :receiver_phone, class: 'form-control', required: true, id: 'receiver_phone' %>
          </div>
          <div class="form-group">
            <label>ƒê·ªãa ch·ªâ nh·∫≠n h√†ng</label>
            <%= f.text_field :receiver_address, class: 'form-control', required: true, id: 'receiver_address' %>
          </div>
        </div>

        <!-- Ph∆∞∆°ng th·ª©c thanh to√°n -->
        <div class="form-section">
          <h3 style="font-size: 16px; font-weight: 500; color: #333; margin-bottom: 15px;">Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
          <div class="payment-methods">
            <div class="payment-method-option">
              <%= f.radio_button :payment_method, 'thanh_toan_khi_nhan_hang', checked: true %>
              <label for="payment_method_thanh_toan_khi_nhan_hang">
                <span class="payment-icon">üíµ</span>
                Thanh to√°n khi nh·∫≠n h√†ng
              </label>
            </div>

            <div class="payment-method-option">
              <%= f.radio_button :payment_method, 'thanh_toan_the' %>
              <label for="payment_method_thanh_toan_the">
                <span class="payment-icon">üí≥</span>
                Thanh to√°n b·∫±ng th·∫ª ng√¢n h√†ng
              </label>
            </div>
          </div>

          <!-- Form th√¥ng tin th·∫ª -->
          <div id="bank_payment_form" style="display: none;" class="card-form">
            <div class="form-group">
              <label>Ch·ªçn ng√¢n h√†ng</label>
              <%= f.select :tennganhang, 
                options_for_select([
                  ['-- Ch·ªçn ng√¢n h√†ng --', ''],
                  ['Vietcombank', 'Vietcombank'],
                  ['Techcombank', 'Techcombank'],
                  ['Vietinbank', 'Vietinbank'],
                  ['BIDV', 'BIDV'],
                  ['Agribank', 'Agribank'],
                  ['MB Bank', 'MB Bank'],
                  ['ACB', 'ACB'],
                  ['Sacombank', 'Sacombank'],
                  ['VPBank', 'VPBank'],
                  ['TPBank', 'TPBank']
                ]), 
                {}, 
                { class: 'form-control bank-select' } 
              %>
            </div>

            <div class="form-group">
              <label>S·ªë th·∫ª</label>
              <%= f.text_field :card_number, class: 'form-control', placeholder: '1234 5678 9012 3456', maxlength: 19 %>
            </div>

            <div class="form-group">
              <label>T√™n ch·ªß th·∫ª</label>
              <%= f.text_field :card_name, class: 'form-control', placeholder: 'NGUYEN VAN A' %>
            </div>
          </div>
        </div>

        <!-- Ph·∫ßn buttons -->
        <div class="button-group">
          <%= link_to 'javascript:history.back()', class: "btn btn-secondary" do %>
            <i class="fas fa-arrow-left"></i> Quay l·∫°i
          <% end %>
          <%= f.submit "ƒê·∫∑t h√†ng", class: "btn btn-primary", data: { disable_with: 'ƒêang x·ª≠ l√Ω...' } %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<style>
  .checkout-container {
    max-width: 1200px;
    margin: 20px auto;
    padding: 20px;
  }

  .checkout-layout {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    padding: 20px;
  }

  .checkout-left {
    grid-column: 1;
  }

  .checkout-right {
    grid-column: 2;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    height: fit-content;
    position: sticky;
    top: 20px;
  }

  .form-section {
    background: white;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }

  .form-section h3 {
    font-size: 16px;
    font-weight: 500;
    color: #333;
    margin-bottom: 15px;
  }

  .form-group {
    margin-bottom: 15px;
  }

  .form-group label {
    display: block;
    font-size: 14px;
    color: #666;
    margin-bottom: 6px;
  }

  .form-control {
    width: 100%;
    padding: 10px 12px;
    font-size: 14px;
    border: 1px solid #ddd;
    border-radius: 6px;
  }

  /* Payment methods */
  .payment-methods {
    margin-top: 10px;
  }

  .payment-method {
    padding: 10px 12px;
    margin-bottom: 8px;
    border: 1px solid #ddd;
    border-radius: 6px;
  }

  .order-button {
    width: 100%;
    padding: 12px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    cursor: pointer;
    margin-top: 20px;
  }

  @media (max-width: 768px) {
    .checkout-layout {
      grid-template-columns: 1fr;
    }
    
    .checkout-right {
      position: static;
      width: 100%;
    }
  }

  /* Style cho ph·∫ßn th√¥ng tin ƒë∆°n h√†ng */
  .order-info {
    margin-top: 25px;
  }

  .order-info h3 {
    font-size: 18px;
    color: #2c3e50;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
  }

  /* Table styles */
  .order-details {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }

  .order-details th,
  .order-details td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #eee;
    vertical-align: middle;
  }

  .order-details th {
    background: #f8f9fa;
    font-weight: 500;
  }

  /* ƒêi·ªÅu ch·ªânh ƒë·ªô r·ªông c√°c c·ªôt */
  .order-details th:first-child,
  .order-details td:first-child {
    width: 100px;
  }

  .order-details th:nth-child(3),
  .order-details td:nth-child(3),
  .order-details th:nth-child(4),
  .order-details td:nth-child(4) {
    width: 120px;
    text-align: right;
  }

  /* C·ªôt s·ªë l∆∞·ª£ng v√† ƒë∆°n gi√° */
  .order-details th:nth-child(2),
  .order-details td:nth-child(2),
  .order-details th:nth-child(3),
  .order-details td:nth-child(3) {
    text-align: right;
    width: 100px;
  }

  /* T·ªïng ti·ªÅn */
  .order-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 8px;
    margin-top: 10px;
    border-top: 2px solid #eee;
  }

  .total-label {
    font-weight: bold;
  }

  /* Checkbox style */
  .form-group input[type="checkbox"] {
    margin-right: 8px;
    cursor: pointer;
  }

  .form-group input[type="checkbox"] + label {
    cursor: pointer;
    color: #666;
    font-size: 14px;
  }

  .form-group input[type="checkbox"]:checked + label {
    color: #4CAF50;
  }

  /* Style cho tr∆∞·ªùng readonly */
  .readonly-field {
    background-color: #f8f9fa !important;
    cursor: not-allowed !important;
    border-color: #e0e0e0 !important;
    color: #666 !important;
  }

  /* Style chung cho form */
  .form-group {
    margin-bottom: 15px;
  }

  .form-group label {
    display: block;
    font-size: 14px;
    color: #666;
    margin-bottom: 6px;
  }

  /* Style cho input readonly t·ª´ CSDL */
  input[readonly],
  input[readonly].form-control {
    background-color: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    padding: 10px 12px;
    width: 100%;
    font-size: 14px;
    color: #333;
    cursor: not-allowed;
    box-shadow: none;
  }

  /* Hover effect cho readonly */
  input[readonly]:hover {
    border-color: #e0e0e0;
    background-color: #f8f9fa;
  }

  /* Focus effect cho readonly */
  input[readonly]:focus {
    outline: none;
    border-color: #e0e0e0;
    box-shadow: none;
  }

  /* Style cho labels */
  label {
    font-weight: 500;
    color: #555;
  }

  /* Style ri√™ng cho t·ª´ng lo·∫°i input */
  input[name="customer_name"],
  input[name="customer_phone"],
  input[name="customer_email"],
  input[name="customer_address"] {
    font-family: inherit;
    letter-spacing: 0.3px;
  }

  /* Payment method styles */
  .payment-methods {
    margin-bottom: 20px;
  }

  .payment-method-option {
    padding: 15px;
    margin-bottom: 10px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .payment-method-option:hover {
    background-color: #f8f9fa;
  }

  .payment-method-option input[type="radio"] {
    margin-right: 10px;
  }

  .payment-method-option label {
    display: flex;
    align-items: center;
    margin: 0;
    cursor: pointer;
    font-weight: 500;
    color: #333;
  }

  .payment-icon {
    margin-right: 10px;
    font-size: 20px;
  }

  /* Bank payment form */
  .card-form {
    margin-top: 15px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
  }

  .bank-select {
    width: 100%;
    padding: 10px;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    color: #333;
  }

  /* Active state for payment method */
  .payment-method-option input[type="radio"]:checked + label {
    color: #4CAF50;
  }

  .payment-method-option input[type="radio"]:checked + label .payment-icon {
    color: #4CAF50;
  }

  /* Th√™m style cho ·∫£nh s·∫£n ph·∫©m */
  .product-image {
    width: 100px;
    padding: 8px;
  }

  .product-image img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 4px;
    border: 1px solid #eee;
  }

  .button-group {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
    gap: 10px;
  }

  .btn {
    padding: 12px 25px;
    border-radius: 8px;
    font-weight: 500;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .btn i {
    margin-right: 8px;
  }

  .btn-primary {
    background-color: #4CAF50;
    color: white;
    border: none;
  }

  .btn-primary:hover {
    background-color: #45a049;
  }

  .btn-secondary {
    background-color: #6c757d;
    color: white;
    border: none;
  }

  .btn-secondary:hover {
    background-color: #5a6268;
  }

  /* Hi·ªáu ·ª©ng khi nh·∫•n */
  .btn:active {
    transform: scale(0.98);
  }

  /* Style cho tr·∫°ng th√°i disabled */
  .btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .checkout-layout {
      grid-template-columns: 1fr;
    }

    .checkout-right {
      width: 100%;
      position: static;
    }
  }
</style>

<script>
  function copyOrderInfo(checkbox) {
    const orderPhone = document.getElementById('order_phone').value;
    const orderAddress = document.getElementById('order_address').value;
    
    const receiverPhone = document.getElementById('receiver_phone');
    const receiverAddress = document.getElementById('receiver_address');
    
    if (checkbox.checked) {
      // Copy th√¥ng tin t·ª´ ng∆∞·ªùi ƒë·∫∑t sang ng∆∞·ªùi nh·∫≠n
      receiverPhone.value = orderPhone;
      receiverAddress.value = orderAddress;
      
      // Th√™m readonly attribute khi checkbox ƒë∆∞·ª£c check
      receiverPhone.setAttribute('readonly', true);
      receiverAddress.setAttribute('readonly', true);
    } else {
      // X√≥a th√¥ng tin v√† b·ªè readonly khi b·ªè check
      receiverPhone.value = '';
      receiverAddress.value = '';
      receiverPhone.removeAttribute('readonly');
      receiverAddress.removeAttribute('readonly');
    }
  }
    
  // Toggle bank payment form
  document.querySelectorAll('input[name="payment_method"]').forEach(radio => {
    radio.addEventListener('change', function() {
      const bankForm = document.getElementById('bank_payment_form');
      if (this.value === 'thanh_toan_the') {
        bankForm.style.display = 'block';
      } else {
        bankForm.style.display = 'none';
      }
    });
  });


  
</script> 